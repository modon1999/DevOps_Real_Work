<h2>Данный плейбук с ролями созданы для развертывания на ОС под управлением Ubuntu/Debian обратного прокси на базе Nginx, с созданием сертификата для каждого сервиса с помощью Let's Encrypt.</h2>

<h3>Version 0.1.0 08.04.2023 Исполнитель: Григорьев Н.С.</h3>
Реализована первая рабочая версия, для списка сервисов из переменной list_service создается сертификат {{ service }}.{{ domain }}, после чего разворачивается обратный прокси Nginx c конфигурацией, которая перенарправляет запросы по путям {{ service }}.{{ domain }} на соответствующие сервисы, при этом перенаправляет HTTP на HTTPS.

---------------------------------------------------------------------------------------------------------------------------------------------------------------------
<h3>Назначение ролей:</h3>

  * create_cert_for_subdomain - данная роль из списка сервисов из переменной list_service создается сертификат {{ service }}.{{ domain }};
  * install_reverse_proxy_nginx - данная роль разворачивается обратный прокси Nginx c конфигурацией, которая перенарправляет запросы по путям {{ service }}.{{ domain }} на соответствующие сервисы, при этом перенаправляет HTTP на HTTPS;

<h3>Используемые переменные:</h3>

  * email - email для создания сертификатов Let's Encrypt.
  * domain - используемый домен, который настроен на узел, на котором разворворачиваем обратный прокси Nginx.
  * list_service - список сервисов, на которые будет перенаправлять обратный прокси Nginx.

<h3>Примечание: в самом плейбуке значение переменных можно зашифровать с помощью ansible vault, или другими доступными способами.</h3>

---------------------------------------------------------------------------------------------------------------------------------------------------------------------
<h3>Инструкция по применению:</h3>

1. Установите ansible(требования: ОС Linux, Python 2.6+ или 3.5+).
2. Создать директорию для проекта(например, mkdir ansible) и перейти в неё.
3. Скопировать данный репозиторий в эту директорию(git clone https://srv.secdev.space/griganik/deploy_reverse_proxy_nginx.git), и переходите в склонированную директорию deploy_reverse_proxy_nginx.
5. Настраиваем соединение с рабочими узлами:
   * В файле hosts.txt меняем ip на ip хоста, где будет развернут keycloak(ansible_host=192.168.20.190).
   * Также меняем пользователя от имени которого мы подключимся по ssh к хосту, где будет развернут keycloak(ansible_user=user).
   * Устанавливаем аутентификацию ssh по паролю(apt-get install sshpass).
   * Проверяем соединение с хостом: ansible keycloak -m ping -k и когда попросит вводим пароль пользователя.
6. Запускаем playbook: ansible-playbook deploy_reverse_proxy_nginx.yaml -k -K, сначала вас попросит ввести пароль пользователя, а затем пароль на использование этим пользователем sudo, вы также можете переназначить перечисленные выше переменные в соответствии с вашими требованиями с помощь параметра --extra-vars:
   * ansible-playbook deploy_reverse_proxy_nginx.yaml -k -K --extra-vars "email=example@yandex.ru domain=example.com"
